<div class="container-fluid page">
  <div class="row d-flex align-items-center justify-content-between">
    <div class="col-12 header"><i class="bi bi-cash"></i>&nbsp; Order Entry Form</div>
  </div>
  <!-- It is just testing.. -->
   <!-- oisdjgvio sfuhsaoudifhgouisad fasgsdg -->
  <div class="row">
    <div class="col-12 mt-0 feeleft ">
      <mat-tab-group (selectedTabChange)="onTabChanged($event)" [(selectedIndex)]="selectedIndex"
        animationDuration="200ms"
        style="background-image: linear-gradient(to bottom right, rgb(8, 2, 68), rgb(7, 32, 146)); color: aliceblue; padding: 12px; border-radius: 5px; padding:0px;">
        <mat-tab>
          <ng-template mat-tab-label style="background-color: rgb(161, 17, 17);">
            <mat-icon class="example-tab-icon">list</mat-icon>
            View List
          </ng-template>
          <!-- start working with Right div (panel) -->
          <div class="p-3 flex-fill" style="width:100% ;">

            <h1>All Order List</h1>

            <!--   <p-table [value]="feesReceivedArray" dataKey="studentName" responsiveLayout="scroll">
                    -------------------------------------- -->
            <p-table #allOrder [value]="getAllOrderdArray" dataKey="id" [paginator]="true" [rows]="5"
              [showCurrentPageReport]="true"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
              [rowsPerPageOptions]="[5,10,25,50]" styleClass="p-datatable-striped"
              [globalFilterFields]="['customer_name','order_date','total_order']">
              <!-- ----------------------------------- -->
              <ng-template pTemplate="caption">
                <div class="flex">
                  <p-button type="button" icon="pi pi-plus" label="ADD" class="p-button-outlined"
                    (click)="onClickAdd();"> </p-button>
                  <!-- <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                            (click)="clear(allOrder)"></button> -->
                  <span class="p-input-icon-left ml-auto">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="allOrder.filterGlobal(getEventValue($event), 'contains')"
                      placeholder="Search keyword" />
                  </span>

                </div>
              </ng-template>
              <!--  --------------------------------------------- -->
              <ng-template pTemplate="header">
                <tr>
                  <th style="width: 3rem"></th>
                  <th>SL</th>
                  <th pSortableColumn="customer_name">Customer Name <p-sortIcon field="customer_name"></p-sortIcon>
                  </th>
                  <th pSortableColumn="order_date">Order Date <p-sortIcon field="order_date"></p-sortIcon>
                  </th>
                  <th pSortableColumn="total_order">Total Order <p-sortIcon field="total_order"></p-sortIcon>
                  </th>

                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-fees let-expanded="expanded" let-rowIndex="rowIndex">
                <tr>
                  <td>
                    <button type="button" pButton pRipple [pRowToggler]="fees"
                      class="p-button-text p-button-rounded p-button-plain"
                      [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                  </td>
                  <td>{{rowIndex+1}}</td>
                  <td>{{fees.customer_name}}</td>
                  <td>{{fees.order_date | date:'dd/MM/yyyy'}}</td>
                  <td>{{fees.total_order | currency: 'INR'}}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="rowexpansion" let-fee class="col-12">
                <tr>
                  <td colspan="5">
                    <div class="p-2">
                      <!--Inner table-->
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th scope="col">Service Date</th>
                            <!-- <th scope="col">Transaction Number</th> -->
                            <th scope="col">Service Name</th>
                            <th scope="col">Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let orderDetail of fee.order_details">
                            <td>{{orderDetail.working_date | date:'dd/MM/yyyy'}}</td>
                            <!--  <td>{{feeDetail.transaction_number}}</td> -->
                            <td>{{orderDetail.work_type_name}}</td>
                            <td>{{orderDetail.rate | currency: 'INR'}}</td>
                            <td><button type="button" class="btn btn-success"
                                (click)="editOrderReceived(orderDetail)"><i class="bi bi-pen"></i></button></td>
                          </tr>
                        </tbody>
                      </table>
                      <!--inner table end-->
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>



          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">trending_up</mat-icon>
            Order Entry
          </ng-template>
          <form [formGroup]="orderFormGroup">
            <div style="background-color:white">
            
              <div class="row">
                <div class="col-sm-6" style="height: 15rem;">
                  <div class="order-master">
                    <div class="row">
                      <div class="col-sm-6">
                        <mat-form-field appearance="outline" style="width:100% ;">
                          <mat-label>Date of Order</mat-label>
                          <input matInput custom #ref [matDatepicker]="orderDate" [(ngModel)]="ngOrderDate"
                            formControlName="orderDate">
                          <mat-datepicker-toggle matSuffix [for]="orderDate"></mat-datepicker-toggle>
                          <mat-datepicker #orderDate></mat-datepicker>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-6">
                        <mat-form-field appearance="outline" style="width:100% ;">
                          <mat-label>Service Type</mat-label>
                          <select matNativeControl #service formControlName="serviceTypeId" (change)="changeServiceTypeId(service.value)" [(ngModel)]="ngModelServiceTypeId">
                            <option value="1">One time</option>
                            <option value="2">Daily</option>
                            <option value="3">Weekly</option>
                            <option value="4">Fortnightly</option>
                            <option value="5">Monthly</option>
                            <option value="6">Quarterly</option>
                            <option value="7">Half yearly</option>
                            <option value="8">Yearly</option>
                            <option value="9">Other</option>
                          </select>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12">
                        <ng-select [items]="customerList" bindLabel="customer_name" class="ngselect-css" bindValue="id"
                          formControlName="customerId" autofocus appendTo="body" (change)="changeCustomerId($event)"
                          placeholder="Customer Name" [(ngModel)]="ngModelcustomerId">
    
                          <ng-template ng-option-tmp let-item="item">
                            {{item.customer_name}},&nbsp; Address:[{{item.address}}]
                          </ng-template>
    
                        </ng-select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12">
                        <mat-form-field appearance="outline" style="width:100% ;">
                          <mat-label>&nbsp; Order Description
                          </mat-label>
                          <input matInput placeholder="Order Description" formControlName="orderDescription"
                            [(ngModel)]="ngModelorderDescription" class="custom">
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6" style="padding: 10px ;background-color: cadetblue; height: 15rem; overflow-x: hidden; overflow-y: auto; font-size: medium;">
                  <p-table [value]="employeeServiceArrary" [tableStyle]="{ 'min-height': '6rem' }">
                    <ng-template pTemplate="header">
                        <tr>
                          <th>ID</th>
                            <th>Name</th>
                            <th>Date</th>
                            <th>Total Service</th>
                            <th>Time 1</th>
                            <th>Time 2</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-schedule>
                        <tr>
                          <td><button pButton class="p-button-rounded p-button-info p-button-outlined"
                            (click)="onGetAgent(schedule.id)">
                            <i class="bi bi-caret-right-fill"></i>
                          </button></td>
                            <td>{{ schedule.employee_name }}</td>
                            <td>{{ schedule.working_date | date: 'dd/MM/yyyy'}}</td>
                            <td>{{ schedule.total_work }}</td>
                            <td>{{ schedule.time1 }}</td>
                            <td>{{ schedule.time2 }}</td>
                        </tr>
                    </ng-template>
                </p-table>
                </div>
              </div>
              <div class="order-details">
                <div class="row">
                  <div class="col-sm-3">
                    <ng-select [items]="workTypeList" bindLabel="work_type_name" class="ngselect-css" bindValue="id"
                      formControlName="workTypeId" autofocus appendTo="body" (change)="changeWorkType($event)"
                      placeholder="Service Name">

                      <ng-template ng-option-tmp let-item="item">
                        {{item.work_type_name}},&nbsp; Rate:[{{item.rate | currency:'INR'}}]
                      </ng-template>
                    </ng-select>
                  </div>
                  <div class="col-sm-1">
                    <mat-form-field appearance="outline" style="width:100% ;">
                      <mat-label>Rate</mat-label>
                      <input matInput placeholder="Rate" formControlName="rate" class="custom">
                    </mat-form-field>
                  </div>
                  <div class="col-sm-2">
                    <mat-form-field appearance="outline" style="width:100% ;">
                      <mat-label>Working Date</mat-label>
                      <input matInput custom #working [matDatepicker]="workingDate" formControlName="workingDate" (dateChange)="changeDateSchedule($event)">
                      <mat-datepicker-toggle matSuffix [for]="workingDate"></mat-datepicker-toggle>
                      <mat-datepicker #workingDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div class="col-sm-1">
                    <mat-form-field appearance="outline" style="width:100% ;">
                      <mat-label>Time</mat-label>
                      <select matNativeControl #time formControlName="workingTime" (change)="onChangeDateTimeSchedule(time.value)">
                        <option value="10:00">10:00</option>
                        <option value="12:00">12:00</option>
                        <option value="14:00">14:00</option>
                        <option value="16:00">16:00</option>
                        <option value="18:00">18:00</option>
                      </select>
                    </mat-form-field>
                  </div>
                  <div class="col-sm-3">
                    <ng-select [items]="employeeList" bindLabel="employee_name" (change)="changeEmployeeSchedule($event)"
                    class="ngselect-css" bindValue="id"
                      formControlName="employeeId" autofocus appendTo="body" placeholder="Employee Name">

                      <ng-template ng-option-tmp let-item="item">
                        <small>  {{item.employee_name}},&nbsp; [{{item.employee_category_name}}] &nbsp; Add:[{{item.address}}]</small> 
                      </ng-template>
                    </ng-select>
                  </div>
                  <div class="col-sm-1">
                    <p-button type="button" icon="pi pi-plus" label="ADD" class="p-button-outlined"
                      (click)="onAddOrder();"> </p-button>
                  </div>

                </div>
                <table class="table table-striped" style="font-size: medium;">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col" style="display: none;">Ledger id</th>
                      <th scope="col">Service Name</th>
                      <th scope="col" align="right">Rate</th>
                      <th scope="col">Service Date</th>
                      <th scope="col">Time</th>
                      <th scope="col">Agent Name</th>
                      <th scope="col">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of tempOrderArray; let indexOfelement=index;">
                      <th scope="row">{{indexOfelement+1}}</th>
                      <th scope="row" style="display: none;">{{item.workTypeId}}</th>
                      <td>{{item.serviceName}}</td>
                      <td align="right">{{item.rate | currency:'INR'}}</td>
                      <td>{{item.workingDate | date: 'dd/MM/yyyy'}}</td>
                      <td>{{item.workingTime}}</td>
                      <td>{{item.employeeName}}</td>
                      <td><button type="button" class="btn btn-danger"
                          (click)="onDelete(indexOfelement);">Remove</button>
                      </td>
                    </tr>
                    <tr class="table table-striped" style="background-color:rgb(183, 183, 188) ;">
                      <th colspan="2">Grand Total</th>

                      <td align="right"><b>{{totalAmount | currency:'INR'}}</b></td>
                      <td>&nbsp;</td>
                      <td>&nbsp;</td>
                      <td>&nbsp;</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <p> <button pButton (click)="onOrderSave();" class="p-button-rounded p-button-info">
                  <i class="bi bi-save" style="font-size: 1rem"> Save </i>
                </button></p>
            </div>
          </form>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">trending_up</mat-icon>
            Testing
          </ng-template>
          <div style="background-color:yellow ;color: black;">
            <pre>
                            save code = {{tempObj | json}}
                        </pre>
          </div>
        </mat-tab>
      </mat-tab-group>

    </div>
  </div>
</div>